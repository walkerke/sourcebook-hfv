# flexibleTabUI.R
flexibleTabUI <- function(id, tab_title, sidebar_inputs = NULL, main_output_module = NULL) {
  ns <- NS(id)
  
  tabPanel(tab_title, 
           sidebarLayout(
             sidebarPanel(
               sidebarElementsUI(ns("controls"), sidebar_inputs)
             ),
             mainPanel(
               if (!is.null(main_output_module)) {
                 main_output_module(ns("output"))
               }
             )
           )
  )
}

# flexibleTab.R
flexibleTab <- function(input, output, session, 
                      sidebar_updates = NULL, 
                      data_processor = NULL,
                      output_module = NULL,
                      output_args = NULL) {
  
  # Initialize sidebar controls
  control_values <- callModule(sidebarElements, "controls", sidebar_updates)
  
  # Process data if processor provided
  processed_data <- NULL
  if (!is.null(data_processor)) {
    processed_data <- data_processor(control_values)
  }
  
  # Initialize output module if provided
  if (!is.null(output_module) && !is.null(output_args)) {
    callModule(output_module, "output", 
               data = processed_data,
               # Add any additional arguments
               title = output_args$title,
               subtitle = output_args$subtitle)
  }
  
  # Return control values and processed data
  return(list(
    controls = control_values,
    data = processed_data
  ))
}